<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib uri="/struts-tags" prefix="s" %>
<!DOCTYPE html>
<html>
<head>
	<title><s:text name="orders.new.pagetitle" /> &gt; <s:text name="orders.new.confirm.pagetitle" /></title>
	<link href="${pageContext.request.contextPath}/css/orders.css" rel="stylesheet" media="screen">
</head>
<body>
	<script type="text/javascript">
	$(document).ready(function() {
		$('#btnModify').click(function() { document.location = '${pageContext.request.contextPath}/admin/orders/chooseproducts'; });
		
		$('#formOrder').submit(function() {
			$('#formOrder .btn-group').each(function(i) {
				$(this).parent().find('input').val($(this).find('button.active').val());
			});
		});
	});
	</script>
	<div class="box padded">
		<ul class="breadcrumb">
		    <li><a href="${pageContext.request.contextPath}/admin/orders/chooseclient">1. <s:text name="orders.new.chooseclient.pagetitle" /> (<c:out value="${client.name}" />)</a> <span class="divider">&gt;</span></li>
		    <li><a href="${pageContext.request.contextPath}/admin/orders/chooseproducts">2. <s:text name="orders.new.chooseproducts.pagetitle" /></a> <span class="divider">&gt;</span></li>
		    <li class="active">3. <s:text name="orders.new.confirm.pagetitle" /></li>
		</ul>
		<form action="${pageContext.request.contextPath}/admin/orders/save" method="POST" class="form-horizontal" id="formOrder">
			<fieldset>
				<legend><s:text name="products" /></legend>
				<table class="table table-condensed orders-list">
					<thead>
						<tr>
							<th><s:text name="product" /></th>
							<th><s:text name="deliver" /></th>
							<th><s:text name="price" /></th>
						</tr>
					</thead>
					<tbody>
						<c:set var="totalPrice" value="0" />
						<c:set var="count" value="0" scope="page" />
						<c:forEach items="${order}" var="item">
							<tr>
								<td>
									${item.name}
									<input type="hidden" name="orderitems[${count}].product.id" value="${item.id}">
									<input type="text" placeholder="Commentaire" name="orderitems[${count}].comment" id="orderitems${count}comment" >
									<input type="hidden" name="orderitems[${count}].menu.id" value="${item.menuId}">
								</td>
								<td>
									<c:choose>
										<c:when test="${item.id != -1}">
											<div class="btn-group" data-toggle="buttons-radio">
												<button type="button" class="btn<c:if test="${item.delivered == true}"> active</c:if>" value="true"><s:text name="yes" /></button>
												<button type="button" class="btn<c:if test="${item.delivered == false}"> active</c:if>" value="false"><s:text name="no" /></button>
											</div>
										</c:when>
										<c:otherwise>
											<s:text name="Menu" />
										</c:otherwise>
									</c:choose>
									<input type="hidden" name="orderitems[${count}].delivered" value="${item.delivered}">
									
								</td>
								<td><fmt:formatNumber value="${item.price}" type="currency" currencySymbol="&euro;" />
								<input type="hidden" name="orderitems[${count}].product.price" value="${item.price}"></td>
							</tr>
							<c:set var="totalPrice" value="${totalPrice + item.price}" />
							<c:set var="count" value="${count + 1}" scope="page" />
						</c:forEach>
					</tbody>
				</table>
				<div class="row-fluid order-info">
					<div class="span8"><small><s:text name="orders.for" /></small> ${client.name}</div>
					<div class="span4"><small><s:text name="orders.total" /></small>&nbsp;<fmt:formatNumber value="${totalPrice}" type="currency" currencySymbol="&euro;"/></div>
				</div>
				<button type="button" class="btn btn-large btn-warning" id="btnModify"><s:text name="orders.new.confirm.modify" /></button>
				<button type="submit" class="btn btn-large btn-success"><s:text name="orders.new.confirm.submit" /></button>
			</fieldset>
		</form>

</div>
</body>
</html>